<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>Hayali Çizgili - Finans Yönetimi</title>
    <meta name="description" content="Kişisel bütçe takip ve finans yönetimi uygulaması">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Local CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/auth.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Auth Container (Supabase Authentication) -->
    <div id="auth-container">
        <div class="auth-card">
            <!-- Logo ve Başlık -->
            <div class="auth-logo">
                <img src="assets/logo.svg" alt="Hayali Çizgili Logo">
                <h1 class="auth-title">Finans Yönetimi</h1>
                <p class="auth-subtitle">Kişisel bütçenizi takip edin</p>
            </div>

            <!-- Giriş Formu -->
            <div id="sign-in-container">
                <form id="sign-in-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="sign-in-email" class="auth-form-label">Email Adresi</label>
                        <div class="auth-input-group">
                            <i class="bi bi-envelope auth-input-icon"></i>
                            <input type="email" id="sign-in-email" class="auth-form-input" placeholder="ornek@email.com" required>
                        </div>
                    </div>

                    <div class="auth-form-group">
                        <label for="sign-in-password" class="auth-form-label">Şifre</label>
                        <div class="auth-input-group">
                            <i class="bi bi-lock auth-input-icon"></i>
                            <input type="password" id="sign-in-password" class="auth-form-input" placeholder="Şifrenizi girin" required>
                            <button type="button" class="auth-password-toggle" onclick="togglePassword('sign-in-password')">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="auth-checkbox-group">
                        <input type="checkbox" id="remember-me" class="auth-checkbox">
                        <label for="remember-me" class="auth-checkbox-label">Beni hatırla</label>
                    </div>

                    <button type="submit" class="auth-btn auth-btn-primary">
                        <i class="bi bi-box-arrow-in-right"></i>
                        Giriş Yap
                    </button>
                </form>

                <div class="auth-form-switch">
                    <p>Hesabınız yok mu?</p>
                    <button type="button" id="show-sign-up" class="auth-switch-btn">Kayıt Ol</button>
                </div>
            </div>

            <!-- Kayıt Formu -->
            <div id="sign-up-container" style="display: none;">
                <form id="sign-up-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="sign-up-email" class="auth-form-label">Email Adresi</label>
                        <div class="auth-input-group">
                            <i class="bi bi-envelope auth-input-icon"></i>
                            <input type="email" id="sign-up-email" class="auth-form-input" placeholder="ornek@email.com" required>
                        </div>
                    </div>

                    <div class="auth-form-group">
                        <label for="sign-up-password" class="auth-form-label">Şifre</label>
                        <div class="auth-input-group">
                            <i class="bi bi-lock auth-input-icon"></i>
                            <input type="password" id="sign-up-password" class="auth-form-input" placeholder="En az 6 karakter" required>
                            <button type="button" class="auth-password-toggle" onclick="togglePassword('sign-up-password')">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="auth-form-group">
                        <label for="sign-up-confirm-password" class="auth-form-label">Şifre Tekrar</label>
                        <div class="auth-input-group">
                            <i class="bi bi-lock auth-input-icon"></i>
                            <input type="password" id="sign-up-confirm-password" class="auth-form-input" placeholder="Şifrenizi tekrar girin" required>
                            <button type="button" class="auth-password-toggle" onclick="togglePassword('sign-up-confirm-password')">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <button type="submit" class="auth-btn auth-btn-primary">
                        <i class="bi bi-person-plus"></i>
                        Kayıt Ol
                    </button>
                </form>

                <div class="auth-form-switch">
                    <p>Zaten hesabınız var mı?</p>
                    <button type="button" id="show-sign-in" class="auth-switch-btn">Giriş Yap</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="auth-loading">
        <div class="auth-loading-content">
            <div class="auth-loading-spinner"></div>
            <p id="auth-loading-message">Yükleniyor...</p>
        </div>
    </div>


    <!-- Ana Uygulama İçeriği -->
    <div id="app-container" style="display: none;">
        <div class="container">
        <!-- Başlık ve Logo -->
        <header class="py-3 mb-4 text-center">
            <div class="row">
                <div class="col">
                    <img src="assets/logo.svg" alt="Logo" class="logo img-fluid" style="max-height: 100px;">
                    <h1 class="mt-2">Kişisel Bütçe Takip</h1>
                </div>
            </div>
        </header>

        <!-- Ana Navigasyon -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4 rounded">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="nav-home">Ana Sayfa</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nav-reports">Raporlar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nav-categories">Kategori Yönetimi</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nav-expense-templates">Gider Şablonları</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nav-auto-expenses">Otomatik Giderler</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <button class="btn btn-outline-danger" onclick="window.app.logout()">
                                <i class="bi bi-box-arrow-right"></i> Çıkış
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Ana Sayfa İçeriği -->
        <div id="page-home">
            <!-- Özet Kartları -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-body text-center py-4">
                            <h5 class="card-title text-success fw-bold">Toplam Gelir</h5>
                            <h2 class="card-text display-6 fw-bold text-success" id="total-income">0 ₺</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-body text-center py-4">
                            <h5 class="card-title text-danger fw-bold">Toplam Gider</h5>
                            <h2 class="card-text display-6 fw-bold text-danger" id="total-expense">0 ₺</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-body text-center py-4">
                            <h5 class="card-title text-primary fw-bold">Net Bakiye</h5>
                            <h2 class="card-text display-6 fw-bold text-primary" id="balance">0 ₺</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grafik ve Hızlı İşlem Alanı -->
            <div class="row mb-4">
                <div class="col-md-8 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Aylık Özet Grafiği</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="monthly-chart" height="250"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Hızlı İşlem Ekle</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-3">
                                <button class="btn btn-success btn-lg mb-2" data-bs-toggle="modal" data-bs-target="#incomeModal">
                                    <i class="bi bi-plus-circle me-2"></i> Gelir Ekle
                                </button>
                                <button class="btn btn-danger btn-lg mb-2" data-bs-toggle="modal" data-bs-target="#expenseModal">
                                    <i class="bi bi-dash-circle me-2"></i> Gider Ekle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Son İşlemler -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center bg-light">
                    <span class="fw-bold">Son İşlemler</span>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-secondary" id="filter-all">Tümü</button>
                        <button class="btn btn-sm btn-outline-success" id="filter-income">Gelir</button>
                        <button class="btn btn-sm btn-outline-danger" id="filter-expense">Gider</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Tarih</th>
                                    <th>Kategori</th>
                                    <th>Açıklama</th>
                                    <th>Miktar</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="transaction-list">
                                <!-- İşlemler JavaScript ile eklenecek -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rapor Sayfası İçeriği -->
        <div id="page-reports" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="daily-report-tab">Günlük Rapor</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="monthly-report-tab">Aylık Rapor</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <!-- Günlük Rapor İçeriği -->
                    <div id="daily-report">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="daily-date" class="form-label">Tarih Seçin</label>
                                <input type="date" class="form-control" id="daily-date">
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Günlük Özet İstatistikler</h5>
                                        <div class="row">
                                            <div class="col-md-4 text-success">
                                                <p>Toplam Gelir</p>
                                                <h4 id="daily-total-income">0 ₺</h4>
                                            </div>
                                            <div class="col-md-4 text-danger">
                                                <p>Toplam Gider</p>
                                                <h4 id="daily-total-expense">0 ₺</h4>
                                            </div>
                                            <div class="col-md-4 text-primary">
                                                <p>Günlük Bakiye</p>
                                                <h4 id="daily-balance">0 ₺</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">İşlem Listesi</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>Kategori</th>
                                                        <th>Açıklama</th>
                                                        <th>Miktar</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="daily-transactions">
                                                    <!-- Günlük işlemler JavaScript ile eklenecek -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Kategori Dağılımı</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="daily-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Haftalık Karşılaştırma</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="weekly-comparison-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Günlük İstatistikler</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-sm">
                                                <tbody>
                                                    <tr>
                                                        <th>En Yüksek Gider Kategorisi:</th>
                                                        <td id="daily-top-category">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Toplam İşlem Sayısı:</th>
                                                        <td id="daily-transaction-count">0</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Günlük Bütçe Durumu:</th>
                                                        <td id="daily-budget-status">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Önceki Güne Göre Değişim:</th>
                                                        <td id="daily-change">0%</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aylık Rapor İçeriği -->
                    <div id="monthly-report" style="display: none;">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="monthly-date" class="form-label">Ay Seçin</label>
                                <input type="month" class="form-control" id="monthly-date">
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h5 class="card-title">Aylık Özet İstatistikler</h5>
                                        <div class="row">
                                            <div class="col-md-3 text-success">
                                                <p>Toplam Gelir</p>
                                                <h4 id="monthly-total-income">0 ₺</h4>
                                            </div>
                                            <div class="col-md-3 text-danger">
                                                <p>Toplam Gider</p>
                                                <h4 id="monthly-total-expense">0 ₺</h4>
                                            </div>
                                            <div class="col-md-3 text-primary">
                                                <p>Bakiye</p>
                                                <h4 id="monthly-balance">0 ₺</h4>
                                            </div>
                                            <div class="col-md-3 text-info">
                                                <p>Gider/Gelir Oranı</p>
                                                <h4 id="monthly-expense-ratio">0%</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Kategorilere Göre Dağılım</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="monthly-pie-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Günlük Bazda Gelir/Gider</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="monthly-line-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Kategori Analizi (Gider)</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="monthly-category-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0">Gelir/Gider Karşılaştırması</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="monthly-comparison-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">En Yüksek Giderler</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover table-striped">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Kategori</th>
                                                        <th>Miktar</th>
                                                        <th>Oran</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="top-expenses">
                                                    <!-- JavaScript ile doldurulacak -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">İstatistikler</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <tbody>
                                                    <tr>
                                                        <th scope="row" class="text-muted">Ortalama Günlük Gider:</th>
                                                        <td class="fw-bold text-dark" id="avg-daily-expense">0 ₺</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="text-muted">En Yüksek Günlük Gider:</th>
                                                        <td class="fw-bold text-danger" id="max-daily-expense">0 ₺</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="text-muted">En Düşük Günlük Gider:</th>
                                                        <td class="fw-bold text-success" id="min-daily-expense">0 ₺</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="text-muted">Geçen Aya Göre Değişim:</th>
                                                        <td class="fw-bold" id="prev-month-change">0%</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kategori Yönetimi Sayfası -->
        <div id="page-categories" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="income-categories-tab">Gelir Kategorileri</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="expense-categories-tab">Gider Kategorileri</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#categoryModal">
                            <i class="bi bi-plus-circle"></i> Yeni Kategori Ekle
                        </button>
                    </div>

                    <!-- Gelir Kategorileri -->
                    <div id="income-categories">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Kategori Adı</th>
                                    <th>Renk</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="income-categories-list">
                                <!-- Kategori listesi JavaScript ile eklenecek -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Gider Kategorileri -->
                    <div id="expense-categories" style="display: none;">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Kategori Adı</th>
                                    <th>Renk</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="expense-categories-list">
                                <!-- Kategori listesi JavaScript ile eklenecek -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dışa Aktarma Sayfası -->
        <div id="page-export" style="display: none;">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Veri Dışa Aktarma</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Belirli bir tarih aralığındaki mali verilerinizi CSV formatında dışa aktarabilirsiniz.</p>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="export-start-date" class="form-label">Başlangıç Tarihi</label>
                            <input type="date" class="form-control" id="export-start-date">
                        </div>
                        <div class="col-md-4">
                            <label for="export-end-date" class="form-label">Bitiş Tarihi</label>
                            <input type="date" class="form-control" id="export-end-date">
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex">
                        <button class="btn btn-primary btn-lg" id="export-csv">
                            <i class="bi bi-file-earmark-spreadsheet me-2"></i> CSV Olarak İndir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gider Şablonları Sayfası -->
        <div id="page-expense-templates" style="display: none;">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Gider Şablonları</h5>
                    <ul class="nav nav-tabs card-header-tabs mt-2">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="expense-templates-tab">Şablonlar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="expense-template-groups-tab">Şablon Grupları</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Gider şablonları, sık kullandığınız giderleri (kargo, baskı, paketleme vb.) bir kez tanımlamanıza ve gelir kaydederken bunları otomatik olarak düşebilmenize olanak tanır.</p>
                    
                    <!-- Şablonlar İçeriği -->
                    <div id="expense-templates-content">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Tanımlı Gider Şablonları</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#expenseTemplateModal">
                                <i class="bi bi-plus-circle me-2"></i>Yeni Şablon Ekle
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Ad</th>
                                        <th>Kategori</th>
                                        <th>Miktar</th>
                                        <th>Açıklama</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="expense-templates-list">
                                    <!-- Gider şablonları listesi JavaScript ile eklenecek -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Bilgi:</strong> Tanımladığınız gider şablonları, gelir kaydederken seçilebilir hale gelir. Seçilen şablonlar brüt gelirden otomatik olarak düşülür ve net geliriniz hesaplanır.
                        </div>
                    </div>
                    
                    <!-- Şablon Grupları İçeriği -->
                    <div id="expense-template-groups-content" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Tanımlı Şablon Grupları</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#expenseTemplateGroupModal">
                                <i class="bi bi-plus-circle me-2"></i>Yeni Şablon Grubu Ekle
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Ad</th>
                                        <th>İçerdiği Şablonlar</th>
                                        <th>Toplam Tutar</th>
                                        <th>Açıklama</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody id="expense-template-groups-list">
                                    <!-- Şablon grupları JavaScript ile eklenecek -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Bilgi:</strong> Şablon grupları, birden fazla gider şablonunu tek seferde ekleyebilmenizi sağlar. Gelir kaydederken bir grup seçtiğinizde, o gruptaki tüm şablonlar otomatik olarak eklenir.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Otomatik Giderler Sayfası -->
        <div id="page-auto-expenses" style="display: none;">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Otomatik Giderler</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Otomatik giderler, gelir eklendiğinde otomatik olarak düşülen giderlerdir.</p>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Tanımlı Otomatik Giderler</h5>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#autoExpenseModal">
                            <i class="bi bi-plus-circle me-2"></i>Yeni Otomatik Gider Ekle
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Durum</th>
                                    <th>Adı</th>
                                    <th>Kategori</th>
                                    <th>Miktar</th>
                                    <th>Açıklama</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="auto-expenses-list">
                                <!-- Otomatik giderler JavaScript ile eklenecek -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle"></i> Otomatik giderler, gelir eklendiğinde otomatik olarak işlenir.
                    </div>
                </div>
            </div>
        </div>

        <!-- Gelir Ekleme Modal -->
        <div class="modal fade" id="incomeModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title">Gelir Ekle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                    </div>
                    <div class="modal-body">
                        <form id="income-form">
                            <div class="mb-3">
                                <label for="income-amount" class="form-label">Miktar (₺)</label>
                                <input type="number" class="form-control" id="income-amount" min="0" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="income-category" class="form-label">Kategori</label>
                                <select class="form-select" id="income-category" required>
                                    <!-- Kategoriler JavaScript ile eklenecek -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="income-date" class="form-label">Tarih</label>
                                <input type="date" class="form-control" id="income-date" required>
                            </div>
                            <div class="mb-3">
                                <label for="income-description" class="form-label">Açıklama</label>
                                <input type="text" class="form-control" id="income-description">
                            </div>
                            
                            <!-- Gider Şablonları Seçimi -->
                            <div class="mb-3">
                                <label class="form-label">Gider Şablonları</label>
                                <ul class="nav nav-tabs mb-2">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#" id="single-templates-tab">Tek Şablonlar</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" id="template-groups-tab">Şablon Grupları</a>
                                    </li>
                                </ul>
                                
                                <div id="single-templates-selector" class="mt-2">
                                    <div class="d-flex mb-2">
                                        <select class="form-select me-2" id="expense-template-select">
                                            <option value="">Gider şablonu seçin...</option>
                                            <!-- Şablonlar JavaScript ile doldurulacak -->
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" id="add-expense-template-to-income">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="template-groups-selector" class="mt-2" style="display: none;">
                                    <div class="d-flex mb-2">
                                        <select class="form-select me-2" id="expense-template-group-select">
                                            <option value="">Şablon grubu seçin...</option>
                                            <!-- Şablon grupları JavaScript ile doldurulacak -->
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" id="add-expense-template-group-to-income">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Seçilen Şablonlar Listesi -->
                                <div id="selected-expense-templates" class="list-group mb-3">
                                    <!-- Seçilen şablonlar JavaScript ile eklenecek -->
                                </div>
                                
                                <!-- Özet Bilgiler -->
                                <div class="card bg-light mb-2">
                                    <div class="card-body p-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Brüt Gelir:</span>
                                            <span id="income-gross-amount">0 ₺</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Toplam Gider:</span>
                                            <span id="income-total-expenses">0 ₺</span>
                                        </div>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Net Gelir:</span>
                                            <span id="income-net-amount">0 ₺</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gizli Alan: Uygulanan Gider Şablonları -->
                            <input type="hidden" id="income-applied-expenses" value="[]">
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <button type="button" class="btn btn-success" id="save-income">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gider Ekleme Modal -->
        <div class="modal fade" id="expenseModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title">Gider Ekle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                    </div>
                    <div class="modal-body">
                        <form id="expense-form">
                            <div class="mb-3">
                                <label for="expense-amount" class="form-label">Miktar (₺)</label>
                                <input type="number" class="form-control" id="expense-amount" min="0" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="expense-category" class="form-label">Kategori</label>
                                <select class="form-select" id="expense-category" required>
                                    <!-- Kategoriler JavaScript ile eklenecek -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="expense-date" class="form-label">Tarih</label>
                                <input type="date" class="form-control" id="expense-date" required>
                            </div>
                            <div class="mb-3">
                                <label for="expense-description" class="form-label">Açıklama</label>
                                <input type="text" class="form-control" id="expense-description">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <button type="button" class="btn btn-danger" id="save-expense">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gider Şablonu Ekleme/Düzenleme Modal -->
        <div class="modal fade" id="expenseTemplateModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Gider Şablonu Ekle/Düzenle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                    </div>
                    <div class="modal-body">
                        <form id="expense-template-form">
                            <input type="hidden" id="expense-template-id">
                            <div class="mb-3">
                                <label for="expense-template-name" class="form-label">Gider Adı</label>
                                <input type="text" class="form-control" id="expense-template-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="expense-template-amount" class="form-label">Miktar (₺)</label>
                                <input type="number" class="form-control" id="expense-template-amount" min="0" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="expense-template-category" class="form-label">Kategori</label>
                                <select class="form-select" id="expense-template-category" required>
                                    <!-- Kategoriler JavaScript ile eklenecek -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="expense-template-description" class="form-label">Açıklama</label>
                                <input type="text" class="form-control" id="expense-template-description">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <button type="button" class="btn btn-primary" id="save-expense-template">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kategori Ekleme/Düzenleme Modal -->
        <div class="modal fade" id="categoryModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Kategori Ekle/Düzenle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                    </div>
                    <div class="modal-body">
                        <form id="category-form">
                            <input type="hidden" id="category-id">
                            <div class="mb-3">
                                <label for="category-name" class="form-label">Kategori Adı</label>
                                <input type="text" class="form-control" id="category-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="category-type" class="form-label">Tür</label>
                                <select class="form-select" id="category-type" required>
                                    <option value="income">Gelir</option>
                                    <option value="expense">Gider</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="category-color" class="form-label">Renk</label>
                                <input type="color" class="form-control form-control-color" id="category-color" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <button type="button" class="btn btn-primary" id="save-category">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Otomatik Gider Ekleme/Düzenleme Modal -->
        <div class="modal fade" id="autoExpenseModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Otomatik Gider Ekle/Düzenle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                    </div>
                    <div class="modal-body">
                        <form id="auto-expense-form">
                            <input type="hidden" id="auto-expense-id">
                            <div class="mb-3">
                                <label for="auto-expense-name" class="form-label">Gider Adı</label>
                                <input type="text" class="form-control" id="auto-expense-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="auto-expense-amount" class="form-label">Miktar (₺)</label>
                                <input type="number" class="form-control" id="auto-expense-amount" min="0" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label for="auto-expense-category" class="form-label">Kategori</label>
                                <select class="form-select" id="auto-expense-category" required>
                                    <!-- Kategoriler JavaScript ile eklenecek -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="auto-expense-description" class="form-label">Açıklama</label>
                                <input type="text" class="form-control" id="auto-expense-description">
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="auto-expense-enabled" checked>
                                <label class="form-check-label" for="auto-expense-enabled">
                                    Etkin
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <button type="button" class="btn btn-primary" id="save-auto-expense">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Şablon Grubu Ekleme/Düzenleme Modal -->
    <div class="modal fade" id="expenseTemplateGroupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Şablon Grubu Ekle/Düzenle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
                </div>
                <div class="modal-body">
                    <form id="expense-template-group-form">
                        <input type="hidden" id="expense-template-group-id">
                        <div class="mb-3">
                            <label for="expense-template-group-name" class="form-label">Grup Adı</label>
                            <input type="text" class="form-control" id="expense-template-group-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="expense-template-group-description" class="form-label">Açıklama</label>
                            <input type="text" class="form-control" id="expense-template-group-description">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Şablonlar</label>
                            <div class="d-flex mb-2">
                                <select class="form-select me-2" id="template-for-group-select">
                                    <option value="">Şablon seçin...</option>
                                    <!-- Şablonlar JavaScript ile doldurulacak -->
                                </select>
                                <button type="button" class="btn btn-outline-secondary" id="add-template-to-group">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                            
                            <!-- Seçilen Şablonlar Listesi -->
                            <div id="group-selected-templates" class="list-group mb-3" style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.25rem;">
                                <!-- Seçilen şablonlar JavaScript ile eklenecek -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between fw-bold">
                                <label class="form-label">Toplam Tutar:</label>
                                <span id="group-total-amount">0 ₺</span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="save-expense-template-group">Kaydet</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <footer class="mt-5 py-3 text-center text-muted border-top">
        <p>Kişisel Bütçe Takip &copy; <span id="current-year">2025</span> | Tüm hakları saklıdır.</p>
    </footer>

    <script>
        // Otomatik yıl güncelleme
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
    <script>
        // Chart.js yüklendiğini kontrol et
        if (typeof Chart === 'undefined') {
            console.error('Chart.js yüklenemedi!');
        } else {
            console.log('Chart.js başarıyla yüklendi:', Chart.version);
        }
    </script>
    <!-- Supabase Integration Scripts -->
    <script src="js/supabase-client.js"></script>
    <script src="js/supabase-data.js"></script>
    
    <!-- Core Application Scripts -->
    <script src="js/charts.js"></script>
    <script src="js/git-db.js"></script>
    <script src="js/optimization.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Authentication Manager (app.js'den sonra yüklenmeli) -->
    <script src="js/auth.js"></script>
    
    <!-- Password Toggle Function -->
    <script>
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'bi bi-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'bi bi-eye';
            }
        }
    </script>
    
    <!-- Mobil Menü -->
    <nav class="mobile-menu">
        <div class="nav">
            <a href="#" class="nav-link active" data-section="dashboard">
                <i class="bi bi-house"></i>
                <span>Ana Sayfa</span>
            </a>
            <a href="#" class="nav-link" data-section="income">
                <i class="bi bi-plus-circle-fill text-success"></i>
                <span>Gelir</span>
            </a>
            <a href="#" class="nav-link" data-section="expense">
                <i class="bi bi-dash-circle-fill text-danger"></i>
                <span>Gider</span>
            </a>
            <a href="#" class="nav-link" data-section="reports">
                <i class="bi bi-bar-chart"></i>
                <span>Raporlar</span>
            </a>
            <a href="#" class="nav-link" data-section="categories">
                <i class="bi bi-tags"></i>
                <span>Kategoriler</span>
            </a>
        </div>
    </nav>
    
    <script>
        // Mobil menü işlevselliği
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuLinks = document.querySelectorAll('.mobile-menu .nav-link');
            
            mobileMenuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Aktif sınıfı kaldır
                    mobileMenuLinks.forEach(l => l.classList.remove('active'));
                    
                    // Tıklanan bağlantıya aktif sınıfı ekle
                    this.classList.add('active');
                    
                    // İlgili bölüme git veya modal'ı aç
                    const section = this.getAttribute('data-section');
                    
                    if (section === 'income') {
                        const incomeModal = new bootstrap.Modal(document.getElementById('incomeModal'));
                        incomeModal.show();
                    } else if (section === 'expense') {
                        const expenseModal = new bootstrap.Modal(document.getElementById('expenseModal'));
                        expenseModal.show();
                    } else if (section === 'categories') {
                        const categoriesModal = new bootstrap.Modal(document.getElementById('categoryModal'));
                        categoriesModal.show();
                    } else if (section === 'reports') {
                        // Rapor bölümüne kaydır
                        const reportsSection = document.querySelector('#page-reports');
                        const dashboardPage = document.querySelector('#page-dashboard');
                        
                        if (reportsSection) {
                            // Görünür hale getir
                            if (dashboardPage) {
                                dashboardPage.style.display = 'none';
                            }
                            reportsSection.style.display = 'block';
                            
                            // Sayfayı kaydır
                            reportsSection.scrollIntoView({ behavior: 'smooth' });
                            
                            // Tüm sekmeleri ve içerik bölümlerini kontrol et
                            const allPages = document.querySelectorAll('[id^="page-"]');
                            allPages.forEach(page => {
                                if (page.id !== 'page-reports') {
                                    page.style.display = 'none';
                                }
                            });
                        }
                        
                        try {
                            // Tab menüsünü güncelle
                            const mainNavLinks = document.querySelectorAll('.nav-main .nav-link');
                            if (mainNavLinks && mainNavLinks.length > 0) {
                                mainNavLinks.forEach(navLink => {
                                    navLink.classList.remove('active');
                                });
                                
                                const reportsLink = document.getElementById('reports-link');
                                if (reportsLink) {
                                    reportsLink.classList.add('active');
                                }
                            }
                        } catch (e) {
                            console.log('Ana menü bulunamadı veya güncelleme sırasında hata oluştu:', e);
                        }
                    } else if (section === 'dashboard') {
                        // Ana sayfaya kaydır
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        
                        // Dashboard'ı görünür yap, diğer sayfaları gizle
                        const dashboardPage = document.querySelector('#page-dashboard');
                        if (dashboardPage) {
                            dashboardPage.style.display = 'block';
                            
                            // Diğer sayfaları gizle
                            const allPages = document.querySelectorAll('[id^="page-"]');
                            allPages.forEach(page => {
                                if (page.id !== 'page-dashboard') {
                                    page.style.display = 'none';
                                }
                            });
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
